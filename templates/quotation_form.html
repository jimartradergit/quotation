<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Quotation | LAXMI STEEL YARD</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(180deg, #f0f4ff, #ffffff);
      margin: 0;
      padding: 0;
    }
    .header {
      background: linear-gradient(90deg, #0b5394, #073763);
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .header h1 { margin: 0; font-size: 28px; letter-spacing: 1px; }
    .container {
      max-width: 950px;
      background: white;
      margin: 30px auto;
      padding: 25px 35px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border-top: 5px solid #0b5394;
    }
    h2, h3 {
      text-align: center;
      color: #0b5394;
      margin-top: 10px;
      text-transform: uppercase;
    }
    label {
      font-weight: 600;
      display: block;
      margin-top: 10px;
      color: #333;
    }
    input[type="text"], input[type="date"], input[type="number"], select {
      width: 100%;
      padding: 10px;
      margin: 5px 0 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-size: 15px;
    }
    input:focus, select:focus {
      border-color: #0b5394;
      box-shadow: 0 0 4px rgba(11, 83, 148, 0.4);
      outline: none;
    }
    .section {
      margin-top: 25px;
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #ddd;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #ffffff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
      font-size: 14px;
    }
    th {
      background-color: #0b5394;
      color: white;
    }
    button {
      background-color: #0b5394;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }
    button:hover {
      background-color: #073763;
      transform: scale(1.03);
    }
    .submit-btn {
      background: linear-gradient(90deg, #0b5394, #073763);
      display: block;
      width: 100%;
      font-size: 18px;
      margin-top: 25px;
      padding: 14px;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      font-weight: bold;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
    }
    .submit-btn:hover {
      background: linear-gradient(90deg, #073763, #0b5394);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transform: translateY(-2px);
    }
    .footer {
      text-align: center;
      font-size: 13px;
      color: #555;
      margin: 20px 0;
    }
    .footer strong { color: #0b5394; }
  </style>
</head>
<body>
  <div class="header">
    <h1>LAXMI STEEL YARD</h1>
    <p>Quotation Management System | Budhagaon, Sangli-416304</p>
  </div>

  <div class="container">
    <h2>{{ 'Edit Quotation' if prefill else 'Create Quotation' }}</h2>
    <form action="/generate_pdf" method="post">

      <!-- COMPANY INFO -->
      <div class="section">
        <h3>Company Information</h3>
        <label>Company Name:</label>
        <input type="text" name="company_name" value="{{ prefill.company_name if prefill else 'LAXMI STEEL YARD' }}" required>

        <label>Company Address:</label>
        <input type="text" name="company_address" value="{{ prefill.company_address if prefill else 'Sangli-Tasgaon Road, Budhgaon-416304' }}" required>

        <label>Email:</label>
        <input type="text" name="company_email" value="{{ prefill.company_email if prefill else 'laxmiyard810@gmail.com' }}" required>

        <label>Phone:</label>
        <input type="text" name="company_phone" value="{{ prefill.company_phone if prefill else '9960709233' }}" required>

        <label>GSTIN:</label>
        <input type="text" name="company_gst" value="{{ prefill.company_gst if prefill else '27AADHN3347N1ZT' }}" required>
      </div>

      <!-- CUSTOMER INFO -->
      <div class="section">
        <h3>Customer Information</h3>
        <label>Customer Name:</label>
        <input type="text" name="customer_name" value="{{ prefill.customer_name if prefill else '' }}" required>
        <label>Billing Address:</label>
        <input type="text" name="customer_address" value="{{ prefill.customer_address if prefill else '' }}" required>
        <label>City/State:</label>
        <input type="text" name="customer_city" value="{{ prefill.customer_city if prefill else '' }}" required>
      </div>

      <!-- SHIPPING INFO -->
      <div class="section">
        <h3>Shipping Information</h3>
        <label>Ship To Name:</label>
        <input type="text" name="shipping_name" value="{{ prefill.shipping_name if prefill else '' }}" required>
        <label>Shipping Address:</label>
        <input type="text" name="shipping_address" value="{{ prefill.shipping_address if prefill else '' }}" required>
        <label>City/State:</label>
        <input type="text" name="shipping_city" value="{{ prefill.shipping_city if prefill else '' }}" required>
      </div>

      <!-- BANK DETAILS -->
      <div class="section">
        <h3>Bank Details</h3>
        <label>Account Holder Name:</label>
        <input type="text" name="account_name" value="{{ prefill.account_name if prefill else 'LAXMI STEEL YARD' }}" required>
        <label>Account Number:</label>
        <input type="text" name="account_number" value="{{ prefill.account_number if prefill else '1046102000057' }}" required>
        <label>IFSC Code:</label>
        <input type="text" name="ifsc_code" value="{{ prefill.ifsc_code if prefill else 'KUCB0488046' }}" required>
        <label>Bank Name:</label>
        <input type="text" name="bank_name" value="{{ prefill.bank_name if prefill else 'The Karad Urban Co-op Bank Ltd, Madhavnagar Branch (Mobile: 9960709233), Sangli' }}" required>
      </div>
      <div class="form-row">
        <label for="note">Additional Note (below bank info):</label>
        <input type="text" id="note" name="note" placeholder="e.g. Delivery time 2-3 days or Loading extra" style="width: 400px;">
      </div>
      <!-- QUOTATION DETAILS -->
      <div class="form-group">
        <label for="transportation_charge">Transportation Charges (â‚¹):</label>
        <input type="number" step="0.01" id="transportation_charge" name="transportation_charge" class="form-control" value="0.00">
      </div>
      <div class="form-group">
        <label for="quotation_number"><b>Quotation Number:</b></label>
        <input type="text" id="quotation_number" name="quotation_number"
              class="form-control" placeholder="Enter Quotation Number (e.g., 001/2025)"
              required>
      </div> 
      <div class="section">
        <h3>Quotation Details</h3>
        <label>Valid Till:</label>
        <input type="date" name="valid_till" value="{{ prefill.valid_till if prefill else '' }}" required>
      </div>

      <!-- PRODUCT TABLE -->
      <div class="section">
        <h3>Product Details</h3>
        <table id="productTable">
          <tr>
            <th>Product</th>
            <th>Description</th>
            <th>Quantity</th>
            <th>Unit Price (â‚¹)</th>
            <th>Action</th>
          </tr>

          {% if prefill and prefill.product_name %}
            {% for i in range(prefill.product_name|length) %}
            <tr>
              <td>
                <select name="product_name" onchange="updateProductInfo(this)" required>
                  <option value="">-- Select Product --</option>
                  {% for p in products %}
                  <option value="{{ p.name }}" data-price="{{ p.price }}" data-desc="{{ p.description }}"
                    {% if p.name == prefill.product_name[i] %}selected{% endif %}>
                    {{ p.name }} ({{ p.unit_type }})
                  </option>
                  {% endfor %}
                </select>
              </td>
              <td><input type="text" name="description" value="{{ prefill.description[i] }}"></td>
              <td><input type="number" step="0.001" name="quantity" value="{{ prefill.quantity[i] }}"></td>
              <td><input type="number" step="0.01" name="unit_price" value="{{ prefill.unit_price[i] }}"></td>
              <td><button type="button" onclick="removeRow(this)">Remove</button></td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td>
                <select name="product_name" onchange="updateProductInfo(this)" required>
                  <option value="">-- Select Product --</option>
                  {% for p in products %}
                  <option value="{{ p.name }}" data-price="{{ p.price }}" data-desc="{{ p.description }}">
                    {{ p.name }} ({{ p.unit_type }})
                  </option>
                  {% endfor %}
                </select>
              </td>
              <td><input type="text" name="description" placeholder="Auto-filled or enter manually"></td>
              <td><input type="number" name="quantity" step="0.001" required></td>
              <td><input type="number" step="0.01" name="unit_price" class="price" required></td>
              <td><button type="button" onclick="removeRow(this)">Remove</button></td>
            </tr>
          {% endif %}
        </table>

        <button type="button" onclick="addRow()">+ Add Product</button>

        <label style="margin-top:20px;">Loading Charges (â‚¹):</label>
        <input type="number" step="0.01" name="loading_charge" value="{{ prefill.loading_charge if prefill else 0 }}">
      </div>

      <!-- SUBMIT -->
      <button class="submit-btn" type="submit">
        ðŸš€ {{ 'Update Quotation PDF' if prefill else 'Generate Quotation PDF' }}
      </button>
    </form>
  </div>

  <div class="footer">
    <p><strong>LAXMI STEEL YARD</strong> | Trusted Partner in Steel Solutions | Â© 2025</p>
  </div>

  <script>
    function addRow() {
      const table = document.getElementById("productTable");
      const row = table.insertRow();
      row.innerHTML = `
        <td>
          <select name="product_name" onchange="updateProductInfo(this)" required>
            <option value="">-- Select Product --</option>
            {% for p in products %}
            <option value="{{ p.name }}" data-price="{{ p.price }}" data-desc="{{ p.description }}">
              {{ p.name }} ({{ p.unit_type }})
            </option>
            {% endfor %}
          </select>
        </td>
        <td><input type="text" name="description" placeholder="Auto-filled or enter manually"></td>
        <td><input type="number" name="quantity" step="0.001" required></td>
        <td><input type="number" step="0.01" name="unit_price" class="price" required></td>
        <td><button type="button" onclick="removeRow(this)">Remove</button></td>
      `;
    }

    function removeRow(button) {
      button.closest("tr").remove();
    }

    function updateProductInfo(select) {
      const selectedOption = select.options[select.selectedIndex];
      const price = selectedOption.getAttribute("data-price");
      const desc = selectedOption.getAttribute("data-desc");
      const row = select.closest("tr");

      const priceInput = row.querySelector('input[name="unit_price"]');
      const descInput = row.querySelector('input[name="description"]');

      if (price) priceInput.value = price;
      if (desc) descInput.value = desc;
    }
  </script>
</body>
</html>
